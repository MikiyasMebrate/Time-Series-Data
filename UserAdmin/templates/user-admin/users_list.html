{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DPMEs</title>
   {% include 'user-admin/include/head.html'%}
  </head>

  <body class="hold-transition sidebar-mini layout-fixed">
    <!--User Registration Modal Start-->
     <!--Data Add Modal Start-->
    <div class="modal fade" id="userRegistration" tabindex="-1" aria-labelledby="userRegistrationLabel" aria-hidden="true">
       <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content">
              <div class="modal-header bg-primary text-white">
                  <h5 class="modal-title" id="userRegistrationLabel">
                      New User Registration
                  </h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form method="post" id="update-user-form" action="{% url 'user-admin-user-list' %}">

                  {% csrf_token %}
                  <div class="modal-body">
                      <div class="mb-3">
                          <label for="{{ form.username.id_for_label }}" class="col-form-label">Username:</label>
                          <input type="text" class="form-control" id="{{ form.username.id_for_label }}" name="{{ form.username.name }}" value="{{ user.username }}" />
                      </div>
                      <div class="row">
                          <div class="col mb-3">
                              <label for="{{ form.first_name.id_for_label }}" class="col-form-label">First Name:</label>
                              <input type="text" class="form-control" id="{{ form.first_name.id_for_label }}" name="{{ form.first_name.name }}" value="{{ user.first_name }}" />
                          </div>
                          <div class="col mb-3">
                              <label for="{{ form.last_name.id_for_label }}" class="col-form-label">Last Name:</label>
                              <input type="text" class="form-control" id="{{ form.last_name.id_for_label }}" name="{{ form.last_name.name }}" value="{{ user.last_name }}" />
                          </div>
                      </div>
                      <div class="mb-3">
                          <label for="{{ form.email.id_for_label }}" class="col-form-label">Email:</label>
                          <input type="email" class="form-control" id="{{ form.email.id_for_label }}" name="{{ form.email.name }}" value="{{ user.email }}" />
                      </div>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                      <button type="submit" class="btn btn-primary">Add User</button>
                  </div>

                  {% if form.errors %}
                       <ul class="errorlist">
                        {% for field, errors in form.errors.items %}
                      {% for error in errors %}
                       <li>{{ field }}: {{ error }}</li>
                     {% endfor %}
                     {% endfor %}
                     </ul>
                      {% endif %}
                    </form>
              </div>
              
          </div>
      </div>
  </div>
  <!--Data Add Modal End-->

 <!-- Edit User Modal Start -->
{% for user in users %}
<div class="modal fade" id="editUserModal{{ user.id }}" tabindex="-1" aria-labelledby="editUserModalLabel{{ user.id }}" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="editUserModalLabel{{ user.id }}">
          Edit User: {{ user.username }}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="post" id="update-user-form" action="{% url 'user-admin-user-list' %}">
          {% csrf_token %}
          <div class="modal-body">
            <div class="mb-3">
              <label for="{{ form.username.id_for_label }}" class="col-form-label">Username:</label>
              <input type="text" class="form-control" id="{{ form.username.id_for_label }}" name="{{ form.username.name }}" value="{{ user.username }}" />
            </div>
            <div class="row">
              <div class="col mb-3">
                <label for="{{ form.first_name.id_for_label }}" class="col-form-label">First Name:</label>
                <input type="text" class="form-control" id="{{ form.first_name.id_for_label }}" name="{{ form.first_name.name }}" value="{{ user.first_name }}" />
              </div>
              <div class="col mb-3">
                <label for="{{ form.last_name.id_for_label }}" class="col-form-label">Last Name:</label>
                <input type="text" class="form-control" id="{{ form.last_name.id_for_label }}" name="{{ form.last_name.name }}" value="{{ user.last_name }}" />
              </div>
            </div>
            <div class="mb-3">
              <label for="{{ form.email.id_for_label }}" class="col-form-label">Email:</label>
              <input type="email" class="form-control" id="{{ form.email.id_for_label }}" name="{{ form.email.name }}" value="{{ user.email }}" />
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Update User</button>
          </div>
          {% if form.errors %}
          <ul class="errorlist">
            {% for field, errors in form.errors.items %}
            {% for error in errors %}
            <li>{{ field }}: {{ error }}</li>
            {% endfor %}
            {% endfor %}
          </ul>
          {% endif %}
        </form>
      </div>
    </div>
  </div>
</div>
{% endfor %}
<!-- Edit User Modal End -->

 <!-- Delete User Modal Start -->
{% for user in users %}
<div class="modal fade" id="deleteUserModal{{ user.id }}" tabindex="-1" aria-labelledby="deleteUserModalLabel{{ user.id }}" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteUserModalLabel{{ user.id }}">
          Delete User: {{ user.username }}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete the user '{{ user.username }}'? This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <form method="post" action="{% url 'delete_user' user_id=user.id %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger">Delete User</button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endfor %}
<!-- Delete User Modal End -->

    {% include 'user-admin/include/navbar.html'%}
    {% include 'user-admin/include/sidebar.html'%}
    <!--Body Start-->
    <div class="content-wrapper">
      <!-- TItle Start-->
      <div class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1 class="m-0">Users Lists</h1>
            </div>
          </div>
        </div>
      </div>
      <!--Title End-->

      {% if action_result %}
      <div class="alert alert-success" role="alert">
        {{ action_result }}
      </div>
    {% endif %}

      <section class="content">
        <div class="container-fluid">
          <!--Card Start-->
          <div class="row">
            <div class="col-lg-4 col-6">
              <div class="small-box bg-info">
                <div class="inner">
                  <h3>{{ total_users_count }}</h3>
                  <h3>{{count2}}</h3>
                  <p>Total Users</p>
                </div>
                <div class="icon">
                  <i class="ion ion-bag"></i>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-6">
              <div class="small-box bg-success">
                <div class="inner">
                  <h3>{{ active_users_count }}</h3>
                  <p>Active Users</p>
                </div>
                <div class="icon">
                  <i class="ion ion-bag"></i>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-6">
              <div class="small-box bg-warning">
                <div class="inner">
                  <h3>{{ inactive_users_count }}</h3>
                  <p>Inactive User</p>
                </div>
                <div class="icon">
                  <i class="ion ion-bag"></i>
                </div>
              </div>
            </div>
          </div>
          <!--Card End-->

          <!--User Registration Button Start-->
          <div class="text-end">
            <button
              type="button"
              class="btn btn-primary mb-2"
              data-bs-toggle="modal"
              data-bs-target="#userRegistration"
              data-bs-whatever="@mdo"
            >
              + Add User
            </button>
          </div>
          <!--User Registration Button End-->
          <!--User Table List Start-->
          <div class="row justify-content-center">
            <div class="col-md-12">
              <div class="table-responsive border p-3 shadow">
                <table
                  id="example"
                  class="table table-striped table-hover table-sm"
                >
                  <thead>
                    <tr>
                      <th>Username</th>
                      <th>Email</th>
                      <th>Created Date</th>
                      <th>Account Status</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  
                  <tbody>
                    {% for user in users %}
                    <tr>
                      <td>{{ user.username }}</td>
                      <td>{{ user.email }}</td>
                      <td>{{ user.date_joined|date:"m-d-y" }}</td>
                      <td>
                        {% if user.is_active %}
                        <span class="badge bg-success badge-lg">Active</span>
                        {% else %}
                        <span class="badge bg-danger badge-lg">Inactive</span>
                        {% endif %}
                      </td>
                      <td>
                        <div class="d-flex justify-content-around text-center">
                          <!-- Edit User Modal Trigger Button -->
                          <button
                            type="button"
                            class="btn btn-primary btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#editUserModal{{ user.id }}"
                          >
                            <i class="fas fa-pen"></i> Edit
                          </button>

                          <!-- Delete User Modal Trigger Button -->
                          <button
                            type="button"
                            class="btn btn-danger btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#deleteUserModal{{ user.id }}"
                          >
                            <i class="fas fa-trash"></i> Delete
                          </button>
                        </div>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!--User Table List End-->
        </div>
      </section>
    </div>
    <!--Body End-->
    {% include 'user-admin/include/footer.html'%}
    {% include 'user-admin/include/footer_js.html'%}
  </body>
</html>
